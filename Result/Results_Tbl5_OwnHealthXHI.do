

include "Step0_SetDirectory"
log using "${log}Result_Admin3_Svy3_Baseline_Interact_OwnHealth_$date", replace text name("Ariel") 

*********************************************************************************************************

use "${working}Admin3_Survey3.dta", clear // using MakeData_Admin3_Survey3.do (June 2022)

lab var admin3_eligible_normal_at_svy5 "Eligible Normal (Full Benefits)" //"Normal Eligible as of December 2017"
lab var admin3_eligible_early_at_svy5 "Eligible Early (Reduced Benefits)" // "Early Eligible as of December 2017"
lab var admin3_eligible_none_at_svy5 "Not Yet Eligible for Benefits" //"Not Eligible as of December 2017"

gen admin3_int_age = int(admin3_age_at_svy3) //truncating age toward 0. Could not skip this step if we want to run peak value py code. Otherwise the merge won't work.

gen admin3_int_yos = int(admin3_yos_at_svy3) //truncating YOS toward 0  Could not skip this step if we want to run peak value py code. Otherwise the merge won't work.

	gen adminsvy3_interact_early_poor = admin3_eligible_early_at_svy5 * svy3_own_health_poor //==> elig_earlyxpoor
	lab var adminsvy3_interact_early_poor "Eligible early * Poor health"
	
	gen adminsvy3_interact_early_good = admin3_eligible_early_at_svy5*(1-svy3_own_health_poor) //==>elig_earlyxgood
	lab var adminsvy3_interact_early_good "Eligible early * Good health"
	
	gen adminsvy3_interact_normal_poor = admin3_eligible_normal_at_svy5*svy3_own_health_poor //==elig_normxpoor
	lab var adminsvy3_interact_normal_poor "Eligible normal * Poor health"
	
	gen adminsvy3_interact_normal_good = admin3_eligible_normal_at_svy5*(1-svy3_own_health_poor) //==>elig_normxgood
	lab var adminsvy3_interact_normal_good "Eligible normal * Good health"

tab admin3_int_age, gen(age)



***********************************************************
*** Table 5: Own Health and Retiree Health Insurance Access
***********************************************************
/*Was generated by HR_Tbl_RHIxHealth*/

global demo "svy3_own_health_poor svy3_sphlthpoor svy3_married_partner admin3_female age2-age13 admin3_int_yos svy3_num_kids_12 svy3_num_kids_34 svy3_num_kids_miss svy3_race_black svy3_race_hisp svy3_race_other svy3_educ_ba admin3_atype_school admin3_atype_stategovt admin3_total_salary_10K_2015"
global pension "admin3_eligible_early_at_svy3 admin3_eligible_normal_at_svy3 admin5_status_not_ret admin3_eligible_none_at_svy5 admin3_eligible_early_at_svy5 admin3_just_eligible_normal_svy5 admin3_past_eligible_normal_svy5"


*** COL 1: Elig x own health TSERS

logit admin5_status_not_ret adminsvy3_interact_early_poor adminsvy3_interact_normal_poor  adminsvy3_interact_early_good adminsvy3_interact_normal_good $demo, robust
 

sum admin5_status_not_ret if e(sample)==1
estadd scalar ymean = r(mean)

test adminsvy3_interact_early_poor = adminsvy3_interact_normal_poor 
estadd scalar pdiff_poor = r(p)

test adminsvy3_interact_early_good = adminsvy3_interact_normal_good 
estadd scalar pdiff_good = r(p)

test adminsvy3_interact_early_poor = adminsvy3_interact_early_good
estadd scalar pearly=r(p)

test adminsvy3_interact_normal_poor =adminsvy3_interact_normal_good
estadd scalar pnorm=r(p)

eststo col1_m


*** COL 2: X OWN HEALTH LGERS

logit admin5_status_not_ret adminsvy3_interact_early_poor adminsvy3_interact_normal_poor  adminsvy3_interact_early_good adminsvy3_interact_normal_good  ///
 $demo if svy3_own_has_rhi == 1, robust
 
sum admin5_status_not_ret if e(sample)==1
estadd scalar ymean = r(mean)

test adminsvy3_interact_early_poor = adminsvy3_interact_normal_poor 
estadd scalar pdiff_poor = r(p)

test adminsvy3_interact_early_good = adminsvy3_interact_normal_good 
estadd scalar pdiff_good = r(p)

test adminsvy3_interact_early_poor = adminsvy3_interact_early_good
estadd scalar pearly=r(p)

test adminsvy3_interact_normal_poor =adminsvy3_interact_normal_good
estadd scalar pnorm=r(p)

eststo col2_m


*** Col 3

logit admin5_status_not_ret adminsvy3_interact_early_poor adminsvy3_interact_normal_poor  adminsvy3_interact_early_good adminsvy3_interact_normal_good  ///
 $demo if svy3_own_has_rhi == 0, robust
 

sum admin5_status_not_ret if e(sample)==1
estadd scalar ymean = r(mean)

test adminsvy3_interact_early_poor = adminsvy3_interact_normal_poor 
estadd scalar pdiff_poor = r(p)

test adminsvy3_interact_early_good = adminsvy3_interact_normal_good 
estadd scalar pdiff_good = r(p)

test adminsvy3_interact_early_poor = adminsvy3_interact_early_good
estadd scalar pearly=r(p)

test adminsvy3_interact_normal_poor =adminsvy3_interact_normal_good
estadd scalar pnorm=r(p)

eststo col3_m



esttab col1_m col2_m col3_m using "${output}Tbl5_OwnHealth_HI.csv", replace lab se(3) b(3)  star(* 0.10 ** 0.05 *** 0.01) ///original file: tbl_rhixhealth.csv
	 mtitle("" "Yes" "No/DK/Missing") sca("ymean Mean of Dep Var"  ///
	"pdiff_poor Poor Health: Early = Normal" "pdiff_good Good Health: Early = Normal" ///
	"pearly  Early: Poor Health = Good Health " "pnorm Normal: Poor Health = Good Health") ///
	 order( adminsvy3_interact_early_poor adminsvy3_interact_normal_poor  adminsvy3_interact_early_good adminsvy3_interact_normal_good ///
	svy3_own_health_poor svy3_sphlthpoor svy3_married_partner admin3_female) ///
	keep(adminsvy3_interact_early_poor adminsvy3_interact_normal_poor  adminsvy3_interact_early_good adminsvy3_interact_normal_good ///
	svy3_own_health_poor svy3_sphlthpoor svy3_married_partner admin3_female) margin ///
	addn("Notes: Data are from the NCRTS active workers in April 2016, see Table 1 for details.  The dependent variable is actively working as of December 2017." ///
	"A full list of covariates is provided in Appendix Table **** and includes years of service, race, education, number of children, type of public employer, salary, and age dummies.") ///
	title(Table 5: Own Health and Retiree Health Insurance Access) 
