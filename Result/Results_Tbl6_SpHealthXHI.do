
include "Step0_SetDirectory"
log using "${log}Result_Admin3_Svy3_Baseline_Interact_SpHealth_$date", replace text name("Ariel") 


*********************************************************************************************************

use "${working}Admin3_Survey3.dta", clear // using MakeData_Admin3_Survey3.do (June 2022)

lab var admin3_eligible_normal_at_svy5 "Eligible Normal (Full Benefits)" //"Normal Eligible as of December 2017"
lab var admin3_eligible_early_at_svy5 "Eligible Early (Reduced Benefits)" // "Early Eligible as of December 2017"
lab var admin3_eligible_none_at_svy5 "Not Yet Eligible for Benefits" //"Not Eligible as of December 2017"

gen admin3_int_age = int(admin3_age_at_svy3) //truncating age toward 0. Could not skip this step if we want to run peak value py code. Otherwise the merge won't work.

gen admin3_int_yos = int(admin3_yos_at_svy3) //truncating YOS toward 0  Could not skip this step if we want to run peak value py code. Otherwise the merge won't work.

tab admin3_int_age, gen(age)

***********************************************************
*** Table 6: Spouseâ€™s Health and Health Insurance Access
***********************************************************
/*Was generated by HR_Tbl_SpHlthxRHI */

keep if svy3_married_partner == 1

*** COL 1: X SP HEALTH

	gen adminsvy3_interact_early_spoor = svy3_sphlthpoor*admin3_eligible_early_at_svy5  //if svy3_married_partner == 1
	lab var adminsvy3_interact_early_spoor "Elig early * Spouse poor health"
	
	gen adminsvy3_interact_early_sgood = (1-svy3_sphlthpoor)*admin3_eligible_early_at_svy5 // if svy3_married_partner == 1
	lab var adminsvy3_interact_early_sgood "Elig early * Spouse good health"
	
	gen adminsvy3_interact_normal_spoor = svy3_sphlthpoor*admin3_eligible_normal_at_svy5 // if svy3_married_partner == 1
	lab var adminsvy3_interact_normal_spoor "Elig normal * Spouse poor health"
	
	gen adminsvy3_interact_normal_sgood = (1-svy3_sphlthpoor)*admin3_eligible_normal_at_svy5 //if svy3_married_partner == 1
	lab var adminsvy3_interact_normal_sgood "Elig normal * Spouse good health"


global demo "svy3_own_health_poor svy3_sphlthpoor svy3_married_partner admin3_female age2-age13 admin3_int_yos svy3_num_kids_12 svy3_num_kids_34 svy3_num_kids_miss svy3_race_black svy3_race_hisp svy3_race_other svy3_educ_ba admin3_atype_school admin3_atype_stategovt admin3_total_salary_10K_2015"
global pension "admin3_eligible_early_at_svy3 admin3_eligible_normal_at_svy3 admin5_status_not_ret admin3_eligible_none_at_svy5 admin3_eligible_early_at_svy5 admin3_just_eligible_normal_svy5 admin3_past_eligible_normal_svy5"


logit admin5_status_not_ret adminsvy3_interact_early_spoor adminsvy3_interact_normal_spoor  adminsvy3_interact_early_sgood adminsvy3_interact_normal_sgood  ///
 $demo, robust
 

sum admin5_status_not_ret if e(sample)==1
estadd scalar ymean = r(mean)

test adminsvy3_interact_early_spoor = adminsvy3_interact_normal_spoor 
estadd scalar pdiff_spoor = r(p)

test adminsvy3_interact_early_sgood = adminsvy3_interact_normal_sgood 
estadd scalar pdiff_sgood = r(p)

test adminsvy3_interact_early_spoor = adminsvy3_interact_early_sgood
estadd scalar pearlys=r(p)

test adminsvy3_interact_normal_spoor =adminsvy3_interact_normal_sgood
estadd scalar pnorms=r(p)

eststo col1_m


*** COL 2

/* sources of spouse health insurance 
v129 - own employer
v130 - my employer
v131 RHI previous
v132 - RHI from my employer
v133 RHI from my prev
v134 mediacaid
v135 other

*my employer: rhi_spcurr
*other insurance: (sp_hashi not rhi_spcurr)
*no insurance
gen sp_resp_ehi = v130 == "Yes" | v132 == "Yes"svy3_sp_resp_ehi

gen sp_hashi = (v129 == "Yes" | v130 == "Yes" | v131 == "Yes" | v132 == "Yes" | v133 == "Yes" | v134 == "Yes" | v135 == "Yes")
tab sp_hashi lgers, row col cell
*tab rhi_spcurr lgers, row col cell

sum v13*

* RESPONDENT HI 
*gen sp_hi_oth = sp_hashi == 1 & rhi_spcurr == 0*/


logit admin5_status_not_ret adminsvy3_interact_early_spoor adminsvy3_interact_normal_spoor  adminsvy3_interact_early_sgood adminsvy3_interact_normal_sgood  ///
 $demo if svy3_sp_resp_ehi == 1, robust
 

sum admin5_status_not_ret if e(sample)==1
estadd scalar ymean = r(mean)

test adminsvy3_interact_early_spoor = adminsvy3_interact_normal_spoor 
estadd scalar pdiff_spoor = r(p)

test adminsvy3_interact_early_sgood = adminsvy3_interact_normal_sgood 
estadd scalar pdiff_sgood = r(p)

test adminsvy3_interact_early_spoor = adminsvy3_interact_early_sgood
estadd scalar pearlys=r(p)

test adminsvy3_interact_normal_spoor =adminsvy3_interact_normal_sgood
estadd scalar pnorms=r(p)

eststo col2_m



*** COL3

logit admin5_status_not_ret adminsvy3_interact_early_spoor adminsvy3_interact_normal_spoor  adminsvy3_interact_early_sgood adminsvy3_interact_normal_sgood  ///
 $demo if svy3_sp_resp_ehi == 0, robust
 

sum admin5_status_not_ret if e(sample)==1
estadd scalar ymean = r(mean)

test adminsvy3_interact_early_spoor = adminsvy3_interact_normal_spoor 
estadd scalar pdiff_spoor = r(p)

test adminsvy3_interact_early_sgood = adminsvy3_interact_normal_sgood 
estadd scalar pdiff_sgood = r(p)

test adminsvy3_interact_early_spoor = adminsvy3_interact_early_sgood
estadd scalar pearlys=r(p)

test adminsvy3_interact_normal_spoor =adminsvy3_interact_normal_sgood
estadd scalar pnorms=r(p)
eststo col3_m


esttab col1_m col2_m col3_m using "${output}Tbl6_SpHealth_HI.csv", replace lab se(3) b(3)  star(* 0.10 ** 0.05 *** 0.01) ///original file: tbl_spxhi.csv
	 mtitle("" "Yes" "No") sca("ymean Mean of Dep Var"  ///
	"pdiff_spoor Sp Poor Health: Early = Normal" "pdiff_sgood Sp Good Health: Early = Normal" ///
	"pearlys  Early: Sp Poor Health = Sp Good Health " "pnorms Normal: Sp Poor Health = Sp Good Health") ///
	 order( adminsvy3_interact_early_spoor adminsvy3_interact_normal_spoor  adminsvy3_interact_early_sgood adminsvy3_interact_normal_sgood ///
	svy3_own_health_poor svy3_sphlthpoor svy3_sphlthpoor admin3_female) ///
	keep(adminsvy3_interact_early_spoor adminsvy3_interact_normal_spoor  adminsvy3_interact_early_sgood adminsvy3_interact_normal_sgood ///
	svy3_own_health_poor svy3_sphlthpoor svy3_sphlthpoor admin3_female) margin ///
	addn("Notes: Data are from the NCRTS active workers in April 2016, see Table 1 for details.  The dependent variable is actively working as of December 2017." ///
	"A full list of covariates is provided in Appendix Table **** and includes years of service, race, education, number of children, type of public employer, salary, and age dummies.") ///
	title(Table 6: Spouse's Health and Health Insurance Access) 
